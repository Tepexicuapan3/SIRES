FROM oven/bun:1-alpine
ARG HTTP_PROXY
ARG HTTPS_PROXY

# === CONFIGURACIÓN DE PROXY ===
ENV HTTP_PROXY=http://10.15.15.56:3128
ENV HTTPS_PROXY=http://10.15.15.56:3128
ENV NO_PROXY=localhost,127.0.0.1,::1

# === SSL CONFIG ===
RUN echo "[install]" > bunfig.toml && \
    echo "proxy = \"http://10.15.15.56:3128\"" >> bunfig.toml && \
    echo "rejectUnauthorized = false" >> bunfig.toml && \
    echo "registry = \"https://registry.npmjs.org/\"" >> bunfig.toml

WORKDIR /app

# Copiar solo package.json y bun.lock para aprovechar caché de Docker
COPY package.json bun.lock* ./

# Instalar dependencias (esto se cachea si package.json no cambió)
RUN bun install --frozen-lockfile

# Copiar el resto del código (esto NO invalida el cache de node_modules)
COPY . .

# Exponer el puerto de Vite
EXPOSE 5173

# Comando para iniciar en modo desarrollo
CMD ["bun", "run", "dev", "--", "--host"]