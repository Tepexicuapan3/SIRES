{% extends './menu.html' %}
{% block title %}Enfermedades{% endblock %}
{% block customCSS %}
{% endblock %}
<style>
    .fa-bars,
    .fa-xmark {
        transition: transform 0.5s ease;
        /* Ajusta el tiempo de la transición aquí */
    }

    /* Pantallas grandes */
    @media (min-width: 576px) {
        .d-block {
            display: block !important;
        }

        .d-sm-none {
            display: none !important;
        }
    }

    /* Pantallas pequeñas */
    @media (max-width: 575.98px) {
        .d-block {
            display: none !important;
        }

        .d-sm-none {
            display: block !important;
        }
    }
</style>
{% block contenido %}
{% include 'mensajes.html' %}
    <div class="page-header pt-3 stc">
        <h3 id="nom_rep">CATÁLOGO DE ENFERMEDADES</h3>
    </div>
    <p class="lead stc" style="font-size: 75%;">
        Este catálogo está enfocado en gestionar y organizar las enfermedades atendidas por los profesionales médicos y clínicos en el sistema de salud.
    </p>
    <hr>
    <div class="container py-3 stc">
        <div class="row justify-content-center">
            <div class="col-lg-12">
                <div class="card text-bg-secondary bg-opacity-10" style="font-size: small;" id="card">
                    <div class="card-header text-dark d-flex">
                        <span>Realice las acciones necesarias en el siguiente catálogo.</span>
                        <div class="ms-auto">
                            <button type="button" onclick="mostrarTarjeta('multiple')" class="btn btn-sm btn-primary btn-rounded" title="Activar o desactivar Versión CIE">
                                <span class="d-none d-sm-inline">ACTIVAR O DESACTIVAR VERSIÓN CIE</span>
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>                                    
                    <div class="card-body">
                        <form name="formulario" id="miFormulario" action="{{url_for('catalogos.cat_enfermedades')}}" method="post">
                            {{ form.hidden_tag() }}
                            <div class="row mb-4 justify-content-center">
                                {{ form.txtId(id="txtId", class="input-form") }}
                                <div class="col-3">
                                    <div class="form-outline mdb-input">
                                        {{ form.txtCve(class="form-control form-control-sm input-form", id="txtCve") }}
                                        <label class="form-label" for="txtCve">{{ form.txtCve.label }}</label>
                                    </div>
                                </div>   
                                <div class="col-6">
                                    <div class="form-outline mdb-input">
                                        {{ form.txtEnfermedad(class="form-control form-control-sm input-form", id="txtEnfermedad") }}
                                        <label class="form-label" for="txtEnfermedad">{{ form.txtEnfermedad.label }}</label>
                                    </div>
                                </div>
                                <div class="col-3">
                                    <div class="form-outline mdb-input">
                                        {{ form.txtVersCie(class="form-control form-control-sm input-form", id="txtVersCie") }}
                                        <label class="form-label" for="txtVersCie">{{ form.txtVersCie.label }}</label>
                                    </div>
                                </div>
                                {{ form.opcion(id="opcion", class="input-form") }}
                            </div>
                        </form>
                        <br>
                        <div class="row">
                            <div class="col-md-12 d-flex justify-content-center">
                                <table>
                                    <tr>
                                        <th class="registro">
                                            <button name="boton" type="button" onclick="enviarFormulario(153)" title="Registrar" class="btn btn-success btn-rounded">
                                                <i class="bi bi-upload"></i>
                                                <span class="d-none d-sm-inline">Registrar</span>
                                            </button>   
                                        </th>
                                        <th class="modificacion" style="display: none; margin-right: 2.5px;">
                                            <button name="boton" type="button" onclick="enviarFormulario(154)" title="Modificar" class="btn btn-warning btn-rounded">
                                                <i class="bi bi-pencil-square"></i>
                                                <span class="d-none d-sm-inline">Modificar</span>
                                            </button>
                                            <button name="boton" type="button" onclick="enviarFormulario(155)" title="Cambiar Estatus" class="btn btn-info btn-rounded">
                                                <i class="bi bi-pencil-square"></i>
                                                <span class="d-none d-sm-inline">Desactivar</span>
                                            </button>
                                        </th>
                                        <th class="mod_estatus" style="display: none; margin-right: 2.5px;">
                                            <button name="boton" type="button" onclick="enviarFormulario(155)" title="Cambiar Estatus" class="btn btn-info btn-rounded">
                                                <i class="bi bi-pencil-square"></i>
                                                <span class="d-none d-sm-inline">Activar</span>
                                            </button>
                                        </th>
                                        <th>
                                            <button type="button" title="Limpiar" value="Limpiar" class="btn btn-dark btn-rounded" onclick="limpiarFormulario()">
                                                <i class="bi bi-backspace-reverse"></i>
                                                <span class="d-none d-sm-inline">Limpiar</span>
                                            </button>
                                        </th>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <br/>
                <div class="card text-bg-secondary bg-opacity-10" style="font-size: small;" id="card_multiple">
                    <div class="card-header text-dark d-flex">
                        <span>SELECIONE LA VERSIÓN DEL CIES CUYOS REGISTROS QUIERE ACTIVAR O DESACTIVAR.</span>
                        <div class="ms-auto">
                            <button type="button" onclick="mostrarTarjeta('individual')" class="btn btn-sm btn-primary btn-rounded" title="Registro y Modificación Individual">
                                <span class="d-none d-sm-inline">REGISTRO Y MODIFICACIÓN INDIVIDUAL</span>
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>                        
                    </div>
                    <div class="card-body">
                        <form name="formulario" id="miFormulario" action="{{url_for('catalogos.cat_enfermedades')}}" method="post">
                            {{ form.hidden_tag() }}
                            <div class="row mb-4 justify-content-center">
                                <div class="col-3">
                                    <div class="form-outline mdb-input">
                                        {{ form.txtCies(class="form-control form-control-sm", id="txtCies", onchange="mostrarOpciones(this.value)" ) }}
                                        <label class="form-label" for="txtCies">{{ form.txtCies.label }}</label>
                                    </div>
                                </div>
                            </div>
                            <br>
                            <div class="row">
                                <div class="col-md-12 d-flex justify-content-center">
                                    <table>
                                        <tr id="opciones_cies">
                                        
                                        </tr>
                                    </table>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div> 
    
    <!--Input de Busqueda y boton imprimir-->
    <form name="formulario" id="formImpresion" action="{{url_for('catalogos.reporte_nuevo')}}" method="post">
        <div class="row d-flex justify-content-center p-3 stc">
            <div class="col-md-3">
                <div class="form-group">
                    <label for="columnas" style="font-size: small;">Columnas:</label>
                    <select multiple class="form-select form-select-sm" id="columnas" style="width: auto; height: auto; overflow: hidden;">
                        <option value="1">CLAVE</option>
                        <option value="2">ENFERMEDAD</option>
                        <option value="3">VERSIÓN CIE</option>
                        <option value="4">ESTATUS</option>
                        <!-- Añadir más opciones según sea necesario -->
                    </select>
                </div>
            </div>
            <div class="col-md-3 mt-auto" style="text-align: center;">
                <div class="col-md-3"></div>
                <div data-mdb-input-init class="form-outline">
                    <input type="text" id="busqueda" name="busqueda" class="form-control form-control-sm" style="background-color: white;"/>
                    <label class="form-label" for="busqueda">Buscar</label>
                </div>
            </div>
            <div class="col-4 mt-auto" style="text-align: left;">
                <!-- Agregar un campo oculto para el número de catálogo -->
                <input type="hidden" id="cat" name="cat" value="enfermedades">
                <button type="button" title="Imprimir" class="btn btn-primary btn-sm btn-rounded" onclick="imprimir()">
                    <i class="bi bi-printer-fill"></i>
                    <span class="d-none d-sm-inline">Imprimir</span>
                </button>
            </div>
        </div>
    </form>

    <!--Tabla-->
    <div class="row d-flex justify-content-center p-3 stc">
        <div class="text-center" style="position: relative; width: 90%;">
            <div class="table-responsive" style="height: 300px;">
                <!-- Contenido de la tabla aquí -->
                {% if enfermedades %}
                    <table id="titulo" class="table table-hover fonthead table-bordered table-sm" style="width: 100%; border-collapse: separate; border-spacing: 0;">
                        <thead class="table-dark">
                            <tr id="encabezado">
                                <th class="no-visible">REGISTRO</th>
                                <th class="visible">CLAVE</th>
                                <th class="visible">ENFERMEDAD</th>
                                <th class="visible">VERSIÓN CIE</th>
                                <th class="visible">ESTATUS</th>
                            </tr>
                        </thead>
                        <tbody id="datos" style="font-size: 80%;">
                            {% for enfermedad in enfermedades %}
                            <tr id="{{ enfermedad.id_enf }}">
                                <td name="txtId" class="no-visible text-center input-form">{{ enfermedad.id_enf }}</td>
                                <td name="txtCve" class="visible texto-largo input-form">{{ enfermedad.cve_enf }}</td>
                                <td name="txtEnfermedad" class="visible texto-largo input-form">{{ enfermedad.enfermedad }}</td>
                                <td name="txtVersCie" class="visible texto-largo input-form">{{ enfermedad.vers_cie }}</td>
                                <td name="txtEstatus" class="visible texto-largo {% if enfermedad.est_enf == 'A' %}table-success{% elif enfermedad.est_enf == 'B' %}table-danger{% endif %}">
                                    {% if enfermedad.est_enf == 'A' %}
                                    ACTIVO
                                    {% elif enfermedad.est_enf == 'B' %}
                                    INACTIVO
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <center>
                        <h3 class="text-center metro" style="color:#970000;">
                            <b> NO <span style="padding-left:40px;"> </span> HAY <span style="padding-left:40px;"> </span> REGISTROS </b>
                        </h3>
                    </center>
                {% endif %}
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script>
        var tarjeta_individual = document.getElementById('card').innerHTML;
        var tarjeta_multiple = document.getElementById('card_multiple').innerHTML;
        document.getElementById('card_multiple').remove();


        function mostrarTarjeta(tarjeta) {
            card = document.getElementById('card');
            if (tarjeta === 'multiple') {
                card.innerHTML = tarjeta_multiple;
            } else if (tarjeta === 'individual') {
                card.innerHTML = tarjeta_individual;
            }
        }
    
        // Desactivar todas las entradas con el mismo valor
        function mostrarOpciones(version) {
            var select_vers_cie = document.getElementById('txtCies');
            var vers_cie = select_vers_cie.value;

            $.ajax({
                url: "{{ url_for('catalogos.actualizar_opciones_cies') }}",
                type: "GET",
                dataType: "json",
                data: {
                    vers_cie: vers_cie
                },
                success: function(data) {
                    var opciones_cies = document.getElementById('opciones_cies');
                    opciones_cies.innerHTML = "";
                    for (let i = 0; i < data.length; i++) {
                        if (data[i].toString() == 'A') {
                            opciones_cies.innerHTML += "<th class='desactivar' style='margin-right: 2.5px;'>" + 
                                            "<button id='btnDesactivar' name='boton' type='button' onclick='enviarFormulario(170)' title='Desactivar' class='btn btn-info btn-rounded'>" +
                                                "<i class='bi bi-pencil-square'></i>" +
                                                "<span class='d-none d-sm-inline'> Desactivar</span>" +
                                            "</button>" +
                                        "</th>";
                        }
                        else if (data[i].toString() == 'B') {
                            opciones_cies.innerHTML += "<th class='activar' style='margin-right: 2.5px;'>" +
                                            "<button id='btnActivar' name='boton' type='button' onclick='enviarFormulario(171)' title='Activar' class='btn btn-info btn-rounded'>" +
                                                "<i class='bi bi-pencil-square'></i>" +
                                                "<span class='d-none d-sm-inline'> Activar</span>" +
                                            "</button>" +
                                        "</th>";
                        }
                    }
                }   
            });
        }    
    </script>
    <script src="{{ url_for ('static', filename='js/catalogos.js') }}"></script>
{% endblock %}
